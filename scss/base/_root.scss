@use '../abstracts' as *;
@use 'sass:map';
@use 'sass:meta';
@use 'sass:list';
@use 'sass:math';

:root {
  // css variables for default color theme
  @each $color, $shade-map in $active-theme {
    $type: meta.type-of($shade-map);

    @if ($type == 'color') {
      --#{$prefix}#{$color-variable-prefix}#{$color}: #{$shade-map};
    } @else if ($type == 'map') {
      @each $shade, $value in $shade-map {
        @if (meta.type-of($value) != 'color') {
          @error '#{$value} is not a color!';
        }
        --#{$prefix}#{$color-variable-prefix}#{$color}-#{$shade}: #{$value};
      }
    } @else {
      @error 'the input is not correct';
    }
  }

  /* Generates CSS variables with clamp() values derived from the font-size-clamp and spacer-clamp maps in fonts.scss and spacing.scss */
  $clamp-prefix: clamp-;
  $clamp-map: map.merge($font-size-clamp, $spacer-clamp);
  @each $key, $map in $clamp-map {
    $threshold: map.keys($map);
    $sizeMin: map.get($map, list.nth($threshold, 1));
    $sizeMax: map.get($map, list.nth($threshold, 2));
    $viewportMin: list.nth($threshold, 1);
    $viewportMax: list.nth($threshold, 2);

    $deltaSize: $sizeMax - $sizeMin;
    $deltaViewport: $viewportMax - $viewportMin;
    $change: math.div($deltaSize, $deltaViewport);

    $preferred: px-to-rem($sizeMax - ($viewportMax * $change));

    $rateOfChange: 100vw * $change;

    $sizeMin: px-to-rem($sizeMin);
    $sizeMax: px-to-rem($sizeMax);

    --#{$prefix}#{$clamp-prefix}#{$key}: clamp(
      #{$sizeMin},
      #{$preferred} + #{$rateOfChange},
      #{$sizeMax}
    );
  }

  $size-map-merge: map.deep-merge($font-sizes, $spacers);

  // css variables for font-size & spacers
  @if (list.length($size-map-merge) > 0) {
    @each $screen-size, $size-map in $size-map-merge {
      @if $screen-size == default {
        @each $size-name, $size-value in $size-map {
          --#{$prefix}#{$size-name}: #{$size-value};
        }
      } @else {
        @include mq($screen-size) {
          @each $size-name, $size-value in $size-map {
            --#{$prefix}#{$size-name}: #{$size-value};
          }
        }
      }
    }
  }

  // css variables for utilities
  // @each $key, $map in $utilities {
  //   $hasVar: map.get($map, 'hasVar');
  //   @if $hasVar {
  //     @each $suffix, $value in $valueObject {
  //       .#{$class}-#{$suffix} {
  //         #{$prefix}#{$property}: $value;
  //       }
  //       @if $responsive {
  //         @each $breakpoint, $size in $grid-breakpoints {
  //           @media (min-width:#{$size}) {
  //             .#{$prefix}#{$class}-#{$breakpoint}-#{$suffix} {
  //               #{$property}: $value;
  //             }
  //           }
  //         }
  //       }
  //     }
  //   }
  // }

  @if ($enable-media-query-dark-mode) {
    @media (prefers-color-scheme: dark) {
      @each $color, $shade-map in map.get($color-theme, dark) {
        @each $shade, $value in $shade-map {
          --#{$prefix}#{$color-variable-prefix}#{$color}-#{$shade}: #{$value};
        }
      }
    }
  }
}

// css variables for other color themes
@each $theme, $theme-map in $color-theme {
  @if ($theme != 'default') {
    :root[data-theme='#{$theme}'] {
      @each $color, $shade-map in $theme-map {
        $type: meta.type-of($shade-map);

        @if ($type == 'color') {
          --#{$prefix}#{$color-variable-prefix}#{$color}: #{$shade-map};
        } @else if ($type == 'map') {
          @each $shade, $value in $shade-map {
            @if (meta.type-of($value) != 'color') {
              @error '#{$value} is not a color!';
            }

            --#{$prefix}#{$color-variable-prefix}#{$color}-#{$shade}: #{$value};
          }
        } @else {
          @error 'the input is not correct';
        }
      }
    }
  }
}
